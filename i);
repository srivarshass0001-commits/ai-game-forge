if (fenceMatch && fenceMatch[1]) {
  jsonStr = fenceMatch[1].trim();
} else {
  // Fallback: best-effort JSON extraction via braces
  const start = text.indexOf("{");
  const end = text.lastIndexOf("}");
  if (start !== -1 && end !== -1 && end > start) {
    jsonStr = text.slice(start, end + 1).trim();
  }
}

try {
  return JSON.parse(jsonStr);
} catch {
  return null;
}
} catch (e) {
  console.error("LLM analysis failed:", e);
  return null;
}

// ... keep existing code (generateGame, generators for Platformer, Shooter, Puzzle/TicTacToe, Arcade, Runner)